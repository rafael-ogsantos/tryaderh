if (self.CavalryLogger) { CavalryLogger.start_js(["UO89c"]); }

__d("MNTAsyncMultiActionHandler",["DOM","FBLogger","MRequest","MResponseData","NativeTemplatesQuickLogModule","QuickPerformanceLogger","XNTAsyncController","ge","invariant","MNTActions"],(function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";__p&&__p();var p=Object.freeze({ANY_ORDER:"ANY_ORDER",BLOCKING:"BLOCKING",CANCEL_PENDING:"CANCEL_PENDING",FIRE_ONCE:"FIRE_ONCE",REQUEST_ORDER:"REQUEST_ORDER"}),q={performAction:function(a){__p&&__p();a.actionid&&(l.markerStart(k.MTOUCH_ASYNC_ACTION,a.actionid),l.annotateMarkerString(k.MTOUCH_ASYNC_ACTION,"async_payload",a["async-payload"],a.actionid));"send-actions"in a&&this._performActions(a["send-actions"]);var c={};if("form-id"in a){var d=n(a["form-id"]);c=this._getRequestDataFromForm(d)}d=a.type;if(d===p.ANY_ORDER){this._fireAction(a,0,a.actionid,d,c);return}var e=b("MNTActions"),f=e.getObjectOnActionStore(a.actionid);f=Object.assign({sequenceNum:-1,payloads:new Map()},f);f instanceof Object||o(0,3561);var g=f.payloads;g instanceof Map||o(0,3561);f=f.sequenceNum+1;switch(d){case p.BLOCKING:case p.FIRE_ONCE:if(g.size>0)return;g.set(f,null);break;case p.CANCEL_PENDING:g=new Map().set(f,null);break;case p.REQUEST_ORDER:g.set(f,null);break}e.setObjectOnActionStore(a.actionid,{sequenceNum:f,payloads:g});this._fireAction(a,f,a.actionid,d,c)},_fireAction:function(a,b,c,d,e){__p&&__p();var f=new i(m.getURIBuilder().getURI());f.setMethod("POST");f.setData({payload:a["async-payload"],data:JSON.stringify(e)});f.setAutoProcess(!1);f.listen("done",function(a){q._onSuccess(a,b,c,d);var e=new j(a);a=f.invoke("process",{request:f,response:e,data:a});a.getStopped()||e.process()});"failure-actions"in a&&f.listen("error",function(){this._performActions(a["failure-actions"])}.bind(this));f.send()},_performActions:function(a){__p&&__p();for(var a=a,c=Array.isArray(a),d=0,a=c?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var e;if(c){if(d>=a.length)break;e=a[d++]}else{d=a.next();if(d.done)break;e=d.value}e=e;var f=b("MNTActions");f.performAction(e)}},_onSuccess:function(a,c,d,e){__p&&__p();var f=a.payload;if(!f){h("native_templates").warn("Empty async action payload. Data object is: %s",JSON.stringify(a));return}a=f.actions;if(e===p.ANY_ORDER){this._performActions(a);return}var g=b("MNTActions"),i=g.getObjectOnActionStore(d);i instanceof Object||o(0,3561);i=i.payloads;i instanceof Map||o(0,3561);if(!i.has(c))return;if(g.isActionCanceled(d))return;switch(e){case p.BLOCKING:case p.CANCEL_PENDING:this._performActions(a);i=new Map();break;case p.FIRE_ONCE:this._performActions(a);break;case p.REQUEST_ORDER:i.set(c,f);for(var e=i.entries(),a=Array.isArray(e),c=0,e=a?e:e[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){if(a){if(c>=e.length)break;f=e[c++]}else{c=e.next();if(c.done)break;f=c.value}f=f;var j=f[0];f=f[1];if(f===null)break;this._performActions(f.actions);i["delete"](j)}break}g.setObjectOnActionStore(d,{payloads:i});d&&l.markerEnd(k.MTOUCH_ASYNC_ACTION,"SUCCESS",d)},_getRequestDataFromForm:function(a){__p&&__p();var b={};a=g.convertFormToListOfPairs(a);for(var c=0;c<a.length;c++){var d=a[c][0];if(d.substr(-2)==="[]"){var e=d.slice(0,-2);e in b?b[e].push(a[c][1]):b[e]=[a[c][1]]}else b[d]=a[c][1]}return b}};e.exports=q}),null);